<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vavoo Proxy Stream</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        #container {
            width: 80%;
            margin: 0 auto;
            padding: 20px;
        }
        #vavooButton {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            margin-bottom: 20px;
        }
        #vavooButton:hover {
            background-color: #45a049;
        }
        .group {
            margin-bottom: 20px;
        }
        .group h3 {
            cursor: pointer;
            background-color: #ddd;
            padding: 10px;
            margin: 0;
            font-size: 18px;
        }
        .channels {
            display: none;
            margin-top: 10px;
        }
        .channel {
            background-color: #f9f9f9;
            margin: 5px 0;
            padding: 10px;
            cursor: pointer;
        }
        .channel:hover {
            background-color: #f1f1f1;
        }
        #videoPlayer {
            width: 100%;
            height: 500px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="container">
        <button id="vavooButton">Vavoo Yayınları</button>
        <div id="groupsContainer"></div>
        <video id="videoPlayer" controls></video>
    </div>

    <script>
        document.getElementById("vavooButton").addEventListener("click", loadGroups);

		async function loadGroups() {
			try {
				const cookie = await getCookie();
				const response = await fetch("https://cors-anywhere.herokuapp.com/https://vavoo.to/channels", {
					method: 'GET',
					headers: {
						"Accept": "application/json",
						"Cookie": `PHPSESSID=${cookie}`,
						"User-Agent": "Mozilla/5.0",
					}
				});

				// Check if the response is valid JSON
				const text = await response.text();
				try {
					const channels = JSON.parse(text);
					const groups = groupChannelsByCountry(channels);

					const groupsContainer = document.getElementById("groupsContainer");
					groupsContainer.innerHTML = ""; // Clear previous groups

					for (const country in groups) {
						const groupDiv = document.createElement("div");
						groupDiv.classList.add("group");

						const groupHeader = document.createElement("h3");
						groupHeader.textContent = country;
						groupHeader.addEventListener("click", () => toggleChannels(country));
						groupDiv.appendChild(groupHeader);

						const channelsDiv = document.createElement("div");
						channelsDiv.classList.add("channels");
						groups[country].forEach(channel => {
							const channelDiv = document.createElement("div");
							channelDiv.classList.add("channel");
							channelDiv.textContent = channel.name;
							channelDiv.addEventListener("click", () => playChannel(channel));
							channelsDiv.appendChild(channelDiv);
						});
						groupDiv.appendChild(channelsDiv);

						groupsContainer.appendChild(groupDiv);
					}
				} catch (e) {
					console.error("Failed to parse response as JSON:", e);
				}
			} catch (error) {
				console.error("Failed to load groups:", error);
			}
		}



        function groupChannelsByCountry(channels) {
            return channels.reduce((groups, channel) => {
                if (!groups[channel.country]) {
                    groups[channel.country] = [];
                }
                groups[channel.country].push(channel);
                return groups;
            }, {});
        }

        function toggleChannels(country) {
            const channelsDiv = document.querySelector(`.group h3:contains(${country}) + .channels`);
            channelsDiv.style.display = channelsDiv.style.display === "none" ? "block" : "none";
        }

        async function playChannel(channel) {
            const cookie = await getCookie();
            const response = await fetch(`https://sv1.wproxy.info/proxy.php/https://vavoo.to/play/${channel.id}/index.m3u8`, {
                method: 'GET',
                headers: {
                    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
                    "Accept-Language": "tr-TR,tr;q=0.9,en-US;q=0.8,en;q=0.7",
                    "Connection": "keep-alive",
                    "Referer": "https://wproxy.net",
                    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36",
                    "sec-ch-ua": "\"Chromium\";v=\"134\", \"Not:A-Brand\";v=\"24\", \"Google Chrome\";v=\"134\"",
                    "sec-ch-ua-mobile": "?0",
                    "sec-ch-ua-platform": "\"Windows\"",
                    "Cookie": `PHPSESSID=${cookie}`
                }
            });
            const streamUrl = await response.text();
            const videoPlayer = document.getElementById("videoPlayer");
            videoPlayer.src = streamUrl;
            videoPlayer.play();
        }

		async function getCookie() {
			try {
				// Attempt to get the PHPSESSID cookie
				const response = await fetch("https://wproxy.net");
				const cookies = response.headers.get('Set-Cookie');

				// Check if cookies are present and parse the PHPSESSID
				if (cookies) {
					const match = cookies.match(/PHPSESSID=([^;]+)/);
					if (match) {
						return match[1]; // Return the PHPSESSID cookie value
					}
				}

				// If PHPSESSID not found, log an error and return a fallback value
				console.error("PHPSESSID cookie not found! Using fallback.");
				return "default-cookie-value";  // Replace with your fallback value if needed
			} catch (error) {
				console.error("Error retrieving cookie:", error);
				return "default-cookie-value";  // Fallback in case of an error
			}
		}


    </script>
</body>
</html>
